<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>丛林闲居-注册</title>
    <link rel="stylesheet" href="style/cy.css">
    <link rel="stylesheet" href="style/style.css">
    <!-- 表单验证start -->
    <script src="/js/jquery.js"></script>
    <script src="/js/jquery.validate.js"></script>
    <script src="/js/jquery.metadata.js"></script>
    <!-- 表单验证stop -->


    <!--layUI-->
    <script type='text/javascript' src='layui/layui.js'></script>
    <link href='layui/css/layui.css' rel="stylesheet" type="text/css" />
</head>
<body>
<!--登录页TOP-->
<div class="index-top1">
    <div class="left">
        <span class="one"><a href=" "><img src="images/logo1.png" height="64px"
                                                             width="158px"></a></span>
    </div>
    <div class="right1">
        <div class="three1">
            <span><img src="images/index_03.png"></span>
            <ul>
                <li class="rx">客户服务热线:</li>
                <li class="phone">400-688-6798</li>
            </ul>
        </div>
    </div>
</div>
<div class="reg">
    <div class="reg-main">
        <p class="top"><img src="images/09.png">注册新用户 <i>已有帐号？去<a href="desk.do">登录</a> > </i></p>
        <form action="/reguser!saveReguser.action" id="reguserForm">
            <table>
                <tr>
                    <td class="with">手机号</td>
                    <td colspan="2"><input type="text" id="mobile" name="mobile" size="32" maxlength="11"
                                           placeholder="请输入11位手机号码" ><i id="mobileImg">*</i></td>
                    <td class="status" style="color: red" id="td1"></td>
                </tr>
                <tr>
                    <td class="with">短信验证码</td>
                    <td>
                        <input id="mobileYZM" type="text" maxlength="6" size="28" placeholder="请输入6位短信验证码"
                               ><i id="mobileYZMImg">*</i>
                    </td>
                    <td><!-- <a href="#" class="hqyzm" onclick="getNumRandom()">获取验证码</a> -->
                        <button type="button" style="margin-left: 22px;width: 110px;height: 30px" id="hqyzm" >获取验证码</button>
                    </td>
                    <td class="status" style="color: red" id="td2"></td>
                </tr>
                <tr>
                    <td class="with">邮箱</td>
                    <td colspan="2">
                        <input name="email" id="email" type="text" size="70" placeholder="请输入邮箱地址"
                               class="required email"><i id="emailImg">*</i>
                    </td>
                    <td class="status" style="color: red"></td>
                </tr>
                <tr>
                    <td class="with">密码</td>
                    <td colspan="2">
                        <input type="password" size="70" placeholder="请输入6-12位" name="password" id="password"
                               class="{required:true,minlength:6}" maxlength="16"><i id="passwordImg">*</i>
                    </td>
                    <td class="status" style="color: red"></td>

                </tr>
                <!-- 没必要 -->
                <!-- <tr>
                    <td></td>
                    <td colspan="3">
                        <p class="one">弱</p><p class="two">中</p><p class="two">强</p>
                    </td>
                </tr> -->
                <tr>
                    <td class="with">确认密码</td>
                    <td colspan="2">
                        <input type="password" id="repassword" size="70" name="repassword" placeholder="请再次输入密码"
                               class="{required:true,minlength:6,equalTo:'#password'}" maxlength="16"><i id="repasswordImg">*</i>
                    </td>
                    <td class="status" style="color: red"></td>
                </tr>
                <!-- 不需要了 -->
                <!--  <tr>
                     <td></td>
                     <td colspan="2" class="xy">
                         <input type="checkbox">同意接受丛林闲居发送的促销信息
                     </td>
                 </tr> -->
                <tr>
                    <td></td>
                    <td colspan="2">
                        <input type="button" value="马上注册" class="mszc" onclick="subForm()">
                    </td>
                </tr>
            </table>
        </form>
    </div>
</div>
<div id="show" class="tcc12 none" style="display: none;">
    <div class="tx-ydm">
        <p class="tx-sm"><span class="one"><img src="images/tx.png">提示</span><span class="two"><img
                src="images/14_01.png" class="close"></span></p><br/><br/><br/>
        <p align="center">恭喜你，注册成功</p><br/><br/><br/>
        <p align="center">点击<a href="/desk.do" style="color:red;">登录</a>进入登录页面</p>
    </div>
</div>
<div id="show2" class="tcc12" style="display: none;">
    <div class="tx-ydm" style="margin-top:250px;">
        <p class="tx-sm"><span class="one"><img src="images/tx.png">提示</span><span class="two"><img
                src="images/14_01.png" class="close"></span></p><br/><br/><br/>
        <p align="center">哦。。。发生了点小意外，不好意思</p><br/><br/><br/>
        <p align="center">点击<a href="/register.do" style="color:red;">注册</a>刷新页面</p>
    </div>
</div>
<footer>
    <ul>
        <li>江西省丛林闲居投资有限公司，工业和信息化部网站备案许可证编号：赣ICP备15010915号</li>
        <li>Copyright © 2015 <a href="#">丛林闲居</a> 版权所有 3wcl.com | 客服中心：400-688-6798</li>
    </ul>
    <p><a href="#"><img src="images/index_48.jpg"></a><a href="#"><img src="images/index_50.jpg"></a><a href="#"><img
            src="images/index_52.jpg"></a> <a href="#"><img src="images/index_54.jpg"></a><a href="#"><img
            src="images/index_56.jpg"></a> <a href="#"><img src="images/index_58.jpg"></a></p>
</footer>
<script type="text/javascript">

    var sjyzm="";  //保存验证码
    //获取验证码
    function yzm(){
        sjyzm="";
        // 0-9的随机数
        for(var i =0;i<6;i++){//循环六次
            var num = Math.random()*9;//Math.random();每次生成(0-1)之间的数;
            num = parseInt(num,10);
            sjyzm+=num;
        }
    }

    /**
     * 验证码倒计时
     */
    var time="";
    function down(second) {
        time=setInterval(function(){
            second-=1;
            $("#hqyzm").text(second+"s后重新发送");
            if(second<=0){
                clearInterval(time); //清除
                $("#hqyzm").text("重新获取");
                $("#hqyzm").attr("disabled",false);
            }
        },1000)
    }
    //提交表单
    function subForm() {

        layui.use('layer', function(){
            var layer = layui.layer;
            if($("#mobileYZM img").attr("src")=="image/unchecked.gif"||$("#mobile").val()==""){
                layer.msg("重新输入手机号");
            }else if($("#mobileYZM img").val()==""||$("#mobileYZM").val()!=sjyzm){
                layer.msg("重新输入验证码");
            }else if($("#email").val()==""||$("#emailImg img").attr("src")=="image/unchecked.gif"){
                layer.msg("重新输入邮箱");
            }else if($("#password").val()==""||$("#passwordImg img").attr("src")=="image/unchecked.gif"){
                layer.msg("重新输入密码");
            }else if($("#repassword").val()==""||$("#repasswordImg img").attr("src")=="image/unchecked.gif"){
                layer.msg("重新输入确认密码");
            }else{
                $.ajax({
                    url:"Reguser/reguserRegister.do",
                    type:"post",
                    data:"username="+$("#mobile").val()+"&email="+$("#email").val()+"&pwd="+$("#password").val(),
                    success:function(res){
                        layui.use('layer', function(){
                            if(res==true){
                                registerOk();
                            }else{
                                registerNo();
                            }
                        });
                    }
                })
            }
        });
    }

    //注册成功
    function registerOk() {
        var show = document.getElementById("show");
        show.style.display = "block";
    }

    function registerNo() {
        var show2 = document.getElementById("show2");
        show2.style.display = "block";
    }
</script>

<script type="text/javascript">

    $(function(){

        //获取验证码
        $("#hqyzm").click(function(){

            var phone = $("#mobile").val(); //获取手机号
            //提示已发送短信
            layui.use('layer', function(){
                var layer = layui.layer;
                if(phone.trim()==""){  //手机号为空
                    layer.msg("请输入手机号");
                }else if($(".sjh img").attr("src")=="image/unchecked.gif"){
                    layer.msg("手机号输入错误");
                }else{
                    yzm(); //生成验证信息
                    //发送验证
                    $.ajax({
                        url:"Reguser/reguserYZM.do",
                        type:"post",
                        data:"phone="+phone+"&yzm="+sjyzm+"&num=2",
                        success:function(res){
                            if(res==true){
                                layer.msg("发送成功");
                                if($("#hqyzm").text().trim()!="获取验证码"){ //判断是否是第一次获取
                                    $("#mobileYZM").trigger("blur"); //重新验证验证码
                                }
                                $("#hqyzm").attr("disabled","disabled");
                                var second =60; //倒计时
                                $("#hqyzm").text(second+"s后重新发送");
                                down(second);
                            }else{
                                layer.msg("发送失败");
                                clearInterval(time); //清除
                                $("#hqyzm").text("重新获取");
                                $("#hqyzm").attr("disabled",false);
                            }
                        }
                    })
                }
            })
        })

        //手机号验证
        $("#mobile").focus(function(){
            $("#mobileImg").html("");
        })
        $("#mobile").blur(function(){
            var mobile = $(this).val();
            var phoneNum = /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/; //手机号码
            var phoneNumCheck = (mobile.trim()).match(phoneNum);
            $("#mobileImg").html("*");
            if(mobile!=""){
                if(!phoneNumCheck){
                    $("#mobileImg").html("<img src='image/unchecked.gif' />");
                }else{
                    $.ajax({
                        url:"Reguser/reguserByUsername.do",
                        type:"post",
                        data:"username="+mobile.trim(),
                        success:function(res){
                            if(res!=""){
                                $("#mobileImg").html("<img src='image/unchecked.gif' />");
                                layui.use('layer', function(){
                                    var layer = layui.layer;
                                    layer.msg("手机号已注册");
                                });
                            }else{
                                $("#mobileImg").html("<img src='image/checked.gif' />");
                            }
                        }
                    })
                }
            }
        })

        //验证码验证
        $("#mobileYZM").focus(function(){
            $("#mobileYZMImg").html("");
        })
        $("#mobileYZM").blur(function(){
            var yzm = $(this).val().trim();

            $("#mobileYZMImg").html("*");
            if(yzm!=""){
                if(yzm!=sjyzm){
                    $("#mobileYZMImg").html("<img src='image/unchecked.gif' />");
                }else{
                    $("#mobileYZMImg").html("<img src='image/checked.gif' />");
                }
            }
        })

        //邮箱验证
        $("#email").focus(function(){
            $("#emailImg").html("");
        })
        $("#email").blur(function(){
            var email = $(this).val();
            var phoneNum = /^([a-zA-Z]|[0-9])(\w|\-)+@[a-zA-Z0-9]+\.([a-zA-Z]{2,4})$/; //邮箱
            var phoneNumCheck = (email.trim()).match(phoneNum);
            $("#emailImg").html("*");
            if(email!=""){
                if(!phoneNumCheck){
                    $("#emailImg").html("<img src='image/unchecked.gif' />");
                }else{
                    $("#emailImg").html("<img src='image/checked.gif' />");
                }
            }
        })

        //密码验证
        $("#password").focus(function(){
            $("#passwordImg").html("");
        })
        $("#password").blur(function(){
            var pwd = $(this).val().trim();

            $("#passwordImg").html("*");
            if(pwd!=""){
                if(pwd.length<6||pwd.length>12){
                    $("#passwordImg").html("<img src='image/unchecked.gif' />");
                }else{
                    $("#passwordImg").html("<img src='image/checked.gif' />");
                }
            }
        })

        //确认密码验证
        $("#repassword").focus(function(){
            $("#repasswordImg").html("");
        })
        $("#repassword").blur(function(){
            var pwd = $("#password").val().trim(); //原密码
            var pwds = $(this).val().trim(); //确认密码

            $("#repasswordImg").html("*");
            if(pwds!=""){
                if(pwd!=pwds){
                    $("#repasswordImg").html("<img src='image/unchecked.gif' />");
                }else{
                    $("#repasswordImg").html("<img src='image/checked.gif' />");
                }
            }
        })
    })
</script>
</body>
</html>